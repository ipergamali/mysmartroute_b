# MySmartRoute

Αυτό το project είναι παράδειγμα εφαρμογής Android.
Προς το παρόν έχει απενεργοποιηθεί το Firebase App Check ώστε να μπορείτε να κάνετε είσοδο χωρίς επιπλέον έλεγχο.
Επιπλέον, η εγγραφή δεν απαιτεί πλέον επιβεβαίωση μέσω SMS.

Από την έκδοση 1.4 ο χάρτης έχει πλέον σταθερό ύψος και εμφανίζεται σωστά.
Από την έκδοση 1.7 το μενού επιλογών είναι πλέον έτοιμο.
Από την έκδοση 1.8 το μενού χρήστη υλοποιήθηκε με κληρονομικότητα.
Από την έκδοση 1.9 τα στοιχεία του UI ακολουθούν τα χρώματα του θέματος.

Από την έκδοση 1.10 τα μενού ορίζονται στο menus.json με ιεραρχία ρόλων.
Από την έκδοση 2.0 εμφανίζεται περιγραφή του μενού ανά ρόλο και προστέθηκε η οθόνη «Ορισμός σημείου ενδιαφέροντος» για τους διαχειριστές.
Από την έκδοση 2.1 οι διευθύνσεις των POI αποθηκεύονται και ομαδοποιημένες στο Firestore.
Από την έκδοση 2.2 ολοκληρώθηκε η επιλογή «Ορισμός σημείου ενδιαφέροντος» στο μενού του διαχειριστή.
Από την έκδοση 2.3 προστέθηκε η οθόνη «Επεξεργασία διαδρομής» για εισαγωγή πολλαπλών POI.
Από την έκδοση 2.4 ξεκίνησε η υλοποίηση της οθόνης «Δήλωση μεταφοράς».
Από την έκδοση 2.5 προστέθηκε ένδειξη προόδου στην οθόνη «Δήλωση μεταφοράς».
Από την έκδοση 2.6 επιτρέπεται η διαγραφή σημείων από τη «Δήλωση μεταφοράς» πατώντας στο marker και έπειτα στο κουμπί με το εικονίδιο "Χ".
Από την έκδοση 2.7 προστέθηκε πεδίο ονόματος διαδρομής, βελτιώθηκε η αλληλεπίδραση με τον χάρτη και διορθώθηκαν προβλήματα αποθήκευσης.
Από την έκδοση 2.8 υλοποιήθηκε η οθόνη «Καταχώρηση οχήματος» και προστέθηκε περιγραφή εκκίνησης.
Από την έκδοση 2.9 η οθόνη «Προετοιμασία ολοκλήρωσης διαδρομής» εμφανίζει τις κρατήσεις ακόμα και χωρίς σύνδεση.
Από την έκδοση 2.10 βελτιώθηκε η διαχείριση σφαλμάτων δικτύου στους χάρτες και αυξήθηκαν τα χρονικά περιθώρια των αιτημάτων προς το Directions API.
Από την έκδοση 2.11 διορθώθηκε πρόβλημα με τον DatePicker στην οθόνη «Λειτουργία διαδρομής» που προκαλούσε σφάλματα μεταγλώττισης.
Από την έκδοση 2.12 ενημερώθηκαν οι βιβλιοθήκες Firebase ώστε να αποφεύγονται σφάλματα επίλυσης εξαρτήσεων.
Για να λειτουργήσει ο χάρτης χρειάζεται να ορίσεις το Google Maps API key στο
`local.properties` της ρίζας του project:

```
MAPS_API_KEY=YOUR_API_KEY
```

Αντικατέστησε το `YOUR_API_KEY` με το πραγματικό κλειδί από το Google Cloud Console.

Το `app/build.gradle.kts` πλέον διαβάζει αυτόματα την τιμή από το `local.properties`,
οπότε αρκεί να προσθέσεις τη γραμμή με το κλειδί και να κάνεις "Sync Project" ή
"Rebuild" για να παραχθεί το `BuildConfig`.
Επιπλέον, φρόντισε να έχεις ενεργοποιήσει το **Maps SDK for Android** στο Google Cloud
και να μην περιορίζεται το κλειδί σε συγκεκριμένο package μέχρι να το προσθέσεις στο project.

Σε περιβάλλοντα CI μπορείς εναλλακτικά να ορίσεις τη μεταβλητή περιβάλλοντος
`MAPS_API_KEY` ώστε το Gradle script να χρησιμοποιήσει το κλειδί χωρίς να
απαιτείται αρχείο `local.properties`.

Μπορείς να επιβεβαιώσεις ότι το κλειδί φορτώθηκε σωστά προσθέτοντας στο κώδικα το παρακάτω απόσπασμα:

```kotlin
val apiKey = MapsUtils.getApiKey(context)
Log.d("Maps", "API key loaded? ${apiKey.isNotEmpty()}")
```

Έτσι θα δεις ένα μήνυμα στο log που επιβεβαιώνει ότι η εφαρμογή διαβάζει το κλειδί.

Αν αντιμετωπίσεις το σφάλμα **"Unresolved reference: BuildConfig"**, έλεγξε τα παρακάτω:

1. Σιγουρέψου ότι έχεις προσθέσει το import

   ```kotlin
   import com.ioannapergamali.mysmartroute.BuildConfig
   ```

   στην αρχή του αρχείου Kotlin όπου χρησιμοποιείς το `BuildConfig`.
2. Επιβεβαίωσε ότι στο `app/build.gradle.kts` είναι ενεργοποιημένο το `buildConfig`
   μέσω της επιλογής:

   ```kotlin
   buildFeatures {
       buildConfig = true
   }
   ```

3. Τέλος, κάνε "Sync Project with Gradle Files" ώστε να παραχθεί ξανά το αρχείο
   `BuildConfig`. Μετά την επιτυχημένη συγχρονίση, το σφάλμα θα εξαφανιστεί.

### Αν ο χάρτης δεν εμφανίζεται

Αν παρά τις παραπάνω ενέργειες το log γράφει `Maps API key loaded: false` και
βλέπεις στην οθόνη το μήνυμα «Google Maps API key is missing», δοκίμασε τα
εξής:

1. Βεβαιώσου ότι το `local.properties` βρίσκεται στον ίδιο φάκελο με τα
   `settings.gradle.kts` και `gradlew`.
2. Στο αρχείο να υπάρχει *μία* γραμμή της μορφής:

   ```
   MAPS_API_KEY=TO_DIKO_SOU_API_KEY
   ```

   χωρίς εισαγωγικά ή επιπλέον κενά.
3. Εκτέλεσε «Clean Project» και στη συνέχεια «Rebuild Project» για να παραχθεί
   ξανά το `BuildConfig` με το σωστό κλειδί.

### Αν δεις "Unresolved reference" για το Gson

Εάν η IDE εμφανίζει σφάλματα του τύπου *Unresolved reference: Gson* ή *TypeToken*, έλεγξε ότι στο αρχείο `app/build.gradle.kts` υπάρχει η γραμμή

```kotlin
implementation("com.google.code.gson:gson:2.13.1") // τελευταία διαθέσιμη έκδοση
```

Στη συνέχεια, στις κλάσεις Kotlin πρόσθεσε τα κατάλληλα imports:

```kotlin
import com.google.gson.Gson
import com.google.gson.reflect.TypeToken

private val gson = Gson()

// Μετατροπή JSON σε αντικείμενο Kotlin
val type = object : TypeToken<User>() {}.type
val user: User = gson.fromJson(jsonString, type)
```
Μετά την προσθήκη ή επιβεβαίωση της παραπάνω εξάρτησης, κάνε "Sync Project with Gradle Files" ώστε να κατέβει το library και να λυθούν τα σφάλματα.

### Αν λάβεις "Domain not allowlisted by project" στην επαναφορά κωδικού

Αν κατά την αποστολή email επαναφοράς κωδικού εμφανιστεί το μήνυμα σφάλματος
`Domain not allowlisted by project`, τότε το custom domain των δυναμικών συνδέσμων
δεν έχει προστεθεί στη λίστα επιτρεπόμενων διευθύνσεων του Firebase. Μεταβείτε στο
Firebase console -> Authentication -> Settings -> Authorized domains και προσθέστε
το domain (π.χ. `mysmartroute.page.link`). Αφού επιτρέψετε το domain, το email
επαναφοράς θα σταλεί κανονικά.

### Αν τα κοντινά μέρη επιστρέφουν "null"

Οι λειτουργίες `fetchNearbyPlaceName` και `fetchNearbyPlaceType` χρησιμοποιούν το
Google Places API. Αν στο logcat βλέπεις μηνύματα όπως
`Nearby place name request failed: REQUEST_DENIED` ή οι τιμές
εμφανίζονται `null`, έλεγξε τα εξής:

1. Στη σελίδα Google Cloud Console πρέπει να είναι ενεργό το **Places API**.
2. Το API key δεν πρέπει να περιορίζεται σε λάθος SHA‑1 ή package name. Για δοκιμές
μπορείς προσωρινά να αφαιρέσεις όλους τους περιορισμούς.

Μετά τις αλλαγές κάνε επανεκκίνηση της εφαρμογής ώστε να χρησιμοποιήσει το σωστό κλειδί.



### Εικονίδιο ειδοποίησης

Για να εμφανιστεί σωστά το εικονίδιο στις ειδοποιήσεις, χρησιμοποίησε τον builder του `NotificationCompat` δίνοντας ένα λευκό εικονίδιο vector στο `setSmallIcon`:

```kotlin
val notification = NotificationCompat.Builder(this, CHANNEL_ID)
    .setSmallIcon(R.drawable.ic_notification)
    .setContentTitle("Τίτλος ειδοποίησης")
    .setContentText("Κείμενο ειδοποίησης")
    .setPriority(NotificationCompat.PRIORITY_DEFAULT)
    .build()
```

Το αρχείο `ic_notification.xml` πρέπει να βρίσκεται στο `res/drawable` και να έχει απλή λευκή μορφή ώστε να προβάλλεται σωστά στη γραμμή ειδοποιήσεων.

### Αποδοχή αδειών Android SDK

Για να αποδεχθείς τις άδειες χρήσης του Android SDK σε περιβάλλον Linux:

1. Εγκατάσταση ή ενημέρωση των command-line tools:
   ```bash
   sdkmanager "cmdline-tools;latest"
   ```
2. Εγκατάσταση των απαραίτητων πακέτων (αν λείπουν):
   ```bash
   sdkmanager "build-tools;35.0.0" "platforms;android-35"
   ```
3. Αποδοχή των αδειών:
   ```bash
   sdkmanager --licenses
   ```
4. (Προαιρετικά) Μεταφορά αδειών σε άλλο μηχάνημα:
   - Αντέγραψε τον φάκελο `licenses` από το `$ANDROID_HOME` και τοποθέτησέ τον στο αντίστοιχο directory του νέου μηχανήματος.

Αν δεις μήνυμα όπως
`Failed to install the following Android SDK packages as some licences have not been accepted`,
εκτέλεσε τις παραπάνω εντολές και βεβαιώσου ότι η μεταβλητή `ANDROID_HOME` δείχνει στη σωστή διαδρομή, π.χ. `/usr/lib/android-sdk`.
